package exception;

import javax.swing.*;
import java.awt.*;
import java.util.ArrayList;

public class MenuButton extends JPanel {

	private JButton mainButton;
	private JPanel subPanel;
	private boolean expanded = false;
	private MenuActionListener listener;
	private String mainPageName;

	private ArrayList<JButton> subButtons = new ArrayList<>();

	private static final Color MAIN_COLOR = new Color(36, 170, 140);
	private static final Color SUB_NORMAL = new Color(36, 170, 140);
	private static final Color SUB_SELECTED = new Color(255, 80, 40);

	public MenuButton(String text, String iconPath) {
		this(text, iconPath, null);
	}

	public MenuButton(String text, String iconPath, String pageName) {

		this.mainPageName = pageName;

		setLayout(new BoxLayout(this, BoxLayout.Y_AXIS));
		setBackground(MAIN_COLOR);
		setAlignmentX(Component.LEFT_ALIGNMENT);

		mainButton = new JButton(text);
		mainButton.setHorizontalAlignment(SwingConstants.LEFT);
		mainButton.setMaximumSize(new Dimension(Integer.MAX_VALUE, 50));
		mainButton.setFocusPainted(false);
		mainButton.setBackground(MAIN_COLOR);
		mainButton.setForeground(Color.WHITE);
		mainButton.setBorder(BorderFactory.createEmptyBorder(10, 20, 10, 10));
		mainButton.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
		mainButton.setOpaque(true);
		mainButton.setContentAreaFilled(true);
		mainButton.setBorderPainted(false);

		add(mainButton);

		subPanel = new JPanel();
		subPanel.setLayout(new BoxLayout(subPanel, BoxLayout.Y_AXIS));
		subPanel.setBackground(MAIN_COLOR);
		subPanel.setVisible(false);

		add(subPanel);

		mainButton.addActionListener(e -> {

			// Nếu có submenu → chỉ toggle
			if (!subButtons.isEmpty()) {
				toggleMenu();
			}
			// Nếu là menu đơn
			else if (listener != null && mainPageName != null) {

				// reset màu cha trước
				setMainSelected(true);

				listener.onMenuSelected(this, mainPageName);
			}
		});
	}

	private void toggleMenu() {
		expanded = !expanded;
		subPanel.setVisible(expanded);
		revalidate();
		repaint();
	}

	public void collapse() {
		expanded = false;
		subPanel.setVisible(false);
	}

	public void addSubMenu(String title, String pageName) {

		JButton subBtn = new JButton("•  " + title);
		subBtn.setHorizontalAlignment(SwingConstants.LEFT);
		subBtn.setMaximumSize(new Dimension(Integer.MAX_VALUE, 40));
		subBtn.setFocusPainted(false);
		subBtn.setBackground(SUB_NORMAL);
		subBtn.setForeground(Color.WHITE);
		subBtn.setBorder(BorderFactory.createEmptyBorder(8, 40, 8, 10));
		subBtn.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
		subBtn.setOpaque(true);
		subBtn.setContentAreaFilled(true);
		subBtn.setBorderPainted(false);

		subBtn.addActionListener(e -> {

			// reset tất cả submenu
			resetSubMenuColor();

			// tô đỏ cái được click
			subBtn.setBackground(SUB_SELECTED);

			// đảm bảo cha không bị đỏ
			mainButton.setBackground(MAIN_COLOR);

			if (listener != null) {
				listener.onMenuSelected(this, pageName);
			}
		});

		subButtons.add(subBtn);
		subPanel.add(subBtn);
	}

	public void resetSubMenuColor() {
		for (JButton btn : subButtons) {
			btn.setBackground(SUB_NORMAL);
		}
	}

	public void setMenuActionListener(MenuActionListener listener) {
		this.listener = listener;
	}

	public interface MenuActionListener {
		void onMenuSelected(MenuButton source, String pageName);
	}

	public void setMainSelected(boolean selected) {

		if (subButtons.isEmpty()) {
			mainButton.setBackground(selected ? SUB_SELECTED : MAIN_COLOR);
		}
	}
}
